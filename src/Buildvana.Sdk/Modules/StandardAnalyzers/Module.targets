<Project>

  <!-- Include standard analyzers. -->
  <ItemGroup Condition="$(UseStandardAnalyzers)">
    <!-- Configured via auto-discovered .editorconfig -->
    <BV_PackageReference Include="Microsoft.CodeAnalysis.FxCopAnalyzers"
                         PrivateAssets="All"
                         IncludeAssets="runtime; build; native; contentfiles; analyzers" />
    <!-- Configured via stylecop.json (or .stylecop.json) to include in AdditionalFiles -->
    <BV_PackageReference Include="StyleCop.Analyzers"
                         PrivateAssets="All"
                         IncludeAssets="runtime; build; native; contentfiles; analyzers" />
  </ItemGroup>

  <!-- Find a stylecop.json or .stylecop.json file to configure StyleCop.Analyzers. -->
  <PropertyGroup Condition="$(UseStandardAnalyzers)">
    <!-- Find stylecop.json -->
    <StyleCopJsonPath>$([MSBuild]::GetPathOfFileAbove('stylecop.json', $(MSBuildProjectFullPath)))</StyleCopJsonPath>
    <!-- Reject if not in repository -->
    <StyleCopJsonPath Condition="'$(StyleCopJsonPath)' != '' And !$(StyleCopJsonPath.StartsWith('$(HomeDirectory)'))" />
  </PropertyGroup>
  <!-- Try alternate name accepted by StyleCop.Analyzers -->
  <PropertyGroup Condition="'$(StyleCopJsonPath)' == ''">
    <!-- Find .stylecop.json -->
    <StyleCopJsonPath>$([MSBuild]::GetPathOfFileAbove('.stylecop.json', $(MSBuildProjectFullPath)))</StyleCopJsonPath>
    <!-- Reject if not in repository -->
    <StyleCopJsonPath Condition="'$(StyleCopJsonPath)' != '' And !$(StyleCopJsonPath.StartsWith('$(HomeDirectory)'))" />
  </PropertyGroup>

  <!-- Automatically and silently add stylecop.json or .stylecop.json file to the project if found. -->
  <ItemGroup Condition="$(UseStandardAnalyzers) And '$(StyleCopJsonPath)' != ''">
    <None Remove="$(StyleCopJsonPath)" />
    <AdditionalFiles Remove="$(StyleCopJsonPath)" />
    <AdditionalFiles Include="$(StyleCopJsonPath)" Link="stylecop.json" Visible="false" />
  </ItemGroup>

  <!-- Include public API analyzers. -->
  <ItemGroup Condition="$(UsePublicApiAnalyzers)">
    <BV_PackageReference Include="Microsoft.CodeAnalysis.PublicApiAnalyzers"
                         PrivateAssets="All"
                         IncludeAssets="runtime; build; native; contentfiles; analyzers" />
    <None Remove="$(MSBuildProjectDirectory)\PublicAPI.Shipped.txt" />
    <None Remove="$(MSBuildProjectDirectory)\PublicAPI.Unshipped.txt" />
    <AdditionalFiles Include="$(MSBuildProjectDirectory)\PublicAPI.Shipped.txt" />
    <AdditionalFiles Include="$(MSBuildProjectDirectory)\PublicAPI.Unshipped.txt" />
  </ItemGroup>

  <!-- Suppress warning CA1707 if AllowUnderscoresInMemberNames is true. -->
  <PropertyGroup Condition="'$(AllowUnderscoresInMemberNames)' == 'true'">
    <NoWarn Condition="'$(NoWarn)' != ''">$(NoWarn);</NoWarn>
    <NoWarn>$(NoWarn)CA1707</NoWarn>
  </PropertyGroup>

</Project>